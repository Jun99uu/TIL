# 23. 실행 컨텍스트

> `클로저`를 이해하기 위해, `실행 컨텍스트`에 대한 이해가 필요하다.

실행 컨텍스트는 자바스크립트의 동작 원리를 담고 있는 핵심 개념이다.

- 실행 컨텍스트를 이해함으로써 이해할 수 있는 것들
  - 스코프를 기반으로 식별자와 식별자에 바인딩된 값을 관리하는 방식
  - 호이스팅이 발생하는 이유
  - 클로저의 동작 방식
  - 태스크 큐와 함께 동작하는 이벤트 핸들러
  - 비동기 처리의 동작 방식

## 📌 23.1 소스코드의 타입

소스코드를 구분하는 네가지 타입이다.

| 소스코드의 타입            | 설명                                                                                       |
| -------------------------- | ------------------------------------------------------------------------------------------ |
| 전역 코드(`global code`)   | 전역에 존재하는 소스코드.<br/>전역에 정의된 함수나 클래스 등 내부 코드는 포함❌            |
| 함수 코드(`function code`) | 함수 내부에 존재하는 소스코드.<br/>함수 내부에 중첩된 함수나 클래스 등 내부 코드는 포함❌  |
| eval 코드(`eval code`)     | 빌트인 전역 함수인 eval 함수에 인수로 전달되는 소스코드                                    |
| 모듈 코드(`module code`)   | 모듈 내부에 존재하는 소스코드를 말한다.<br/>모듈 내부에 함수나 클래스 등 내부코드는 포함❌ |

### ✅ 전역 코드(global code)

- 최상위 스코프인 **전역 스코프**를 생성한다.
  - 전역 변수를 관리하기 위함이다.
- 전역 변수, 전역 함수가 전역 객체가 연결된다.
  - `var` 키워드로 선언된 전역 변수
  - 함수 선언문으로 정의된 전역 함수
  - 전역 객체의 프로퍼티와 메서드로 바인딩하고 참조하기 위함이다.

### ✅ 함수 코드(`function code`)

- **지역 스코프**를 생성한다.
  - `지역 변수` `매개변수` `arguments 객체`를 관리한다.
  - 전역 스코프에서 관리하는 체인의 일원으로 연결한다.
- 함수 코드가 평가되면 함수 실행 컨텍스트가 생성된다.

### ✅ eval 코드(`eval code`)

- `strict mode`에서 **독자적인 스코프**를 생성한다.
- eval 코드가 평가되면 eval 실행 컨텍스트가 생성된다.

### ✅ 모듈 코드(`module code`)

- 모듈별로 독립적인 **모듈 스코프**를 생성한다.
- 모듈 코드가 평가되면 모듈 실행 컨텍스트가 생성된다.

## 📌소스코드의 평가와 실행

위 과정에서, 모든 소스코드는 **`평가 과정`을 마친 후 `실행 준비`** 를 했다.

![image](https://eunhyejung.github.io/assets/contents/js/content01_executioncontext.PNG)

즉 자바스크립트 엔진은 소스코드를 두개의 과정으로 나누어 처리한다는 것을 알 수 있었다.

### ✅ 소스코드의 평가

1. 실행 컨텍스트를 생성한다.
2. 변수, 함수등의 선언문만 먼저 실행한다.
3. 해당 변수와 함수 식별자를 `Key`로, 실행 컨텍스트가 관리하는 스코프에 등록한다.

### ✅ 소스코드의 실행

1. 평가 과정이 끝나고 실행이 시작된다.
2. 선언문을 제외한 소스코드가 순차적으로 실행된다.
   - 이를 `런타임`이라고 한다.
3. 실행에 필요한 정보를 실행 컨텍스트가 관리하는 스코프에서 검색하여 취득한다.
   - 해당 정보는 변수나 함수의 참조이다.
4. 소스코드 실행 결과는 다시 실행 컨텍스트가 관리하는 스코프에 등록된다.

### ✅ 예제

```javascript
var x;
x = 1;
```

- **소스코드의 평가**
  1. `var x;`가 실행된다.
  2. 변수 식별자 `x`는 실행 컨텍스트가 관리하는 스코프에 등록된다.
  3. `undefined`로 초기화된다.
- **소스코드의 실행**
  1. `x` 변수가 선언된 변수인지 확인한다.
     - 실행 컨텍스트가 관리하는 스코프에 `x`가 등록되어있는지 확인한다.
  2. `x = 1;`만 실행된다.

## 23.2 실행 컨텍스트의 역할

```javascript
// 전역 변수 선언
const x = 1;
const y = 2;

// 함수 정의
function foo(a) {
  // 지역 변수 선언
  const x = 10;
  const y = 20;

  // 메서드 호출
  console.log(a + x + y); // 130
}

// 함수 호출
foo(100);

// 메서드 호출
console.log(x + y); // 3
```

121
